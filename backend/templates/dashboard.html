{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

  <h3 class="mb-4">Welcome, {{ current_user.username }} ğŸ‘‹</h3>

  <!-- ADD TASK FORM -->
  <form method="POST" action="{{ url_for('routes.dashboard') }}" class="card p-3 mb-4 shadow-sm">
    <div class="row g-2">

      <div class="col-md-3">
        <input type="text" name="title" class="form-control" placeholder="Task title" required>
      </div>

      <div class="col-md-4">
        <input type="text" name="description" class="form-control" placeholder="Description">
      </div>

      <div class="col-md-2">
        <select name="priority" class="form-select">
          <option>Low</option>
          <option selected>Medium</option>
          <option>High</option>
        </select>
      </div>

      <div class="col-md-2">
        <input type="date" name="due_date" class="form-control">
      </div>

      <div class="col-md-1">
        <button type="submit" class="btn btn-primary w-100">+</button>
      </div>

    </div>
  </form>

  <!-- TASK FILTERS -->
  <div class="btn-group mb-4">
    <a href="{{ url_for('routes.dashboard') }}" class="btn btn-outline-primary {% if not status %}active{% endif %}">All</a>
    <a href="{{ url_for('routes.dashboard', status='pending') }}" class="btn btn-outline-warning {% if status == 'pending' %}active{% endif %}">Pending</a>
    <a href="{{ url_for('routes.dashboard', status='completed') }}" class="btn btn-outline-success {% if status == 'completed' %}active{% endif %}">Completed</a>
  </div>

  <!-- SEARCH -->
  <form method="GET" class="mb-3">
    <div class="input-group">
      <input type="text" name="search" class="form-control" placeholder="Search tasks..." value="{{ search or '' }}">
      <button class="btn btn-outline-secondary">ğŸ”</button>
    </div>
  </form>

  <!-- TASK LIST -->
  {% for task in tasks %}
  <div class="card mb-2 shadow-sm {% if task.completed %}border-success{% endif %}">
    <div class="card-body d-flex justify-content-between align-items-center">

      <div>
        <h5 class="{% if task.completed %}text-decoration-line-through text-muted{% endif %}">
          {{ task.title }}
        </h5>

        <small>
          {{ task.priority }} |
          {{ task.due_date or "N/A" }}
        </small>
      </div>

      <div>
        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editTaskModal{{ task.id }}">âœ</button>
        {% if not task.completed %}
        <a href="{{ url_for('routes.complete_task', id=task.id) }}" class="btn btn-outline-success btn-sm">âœ”</a>
        {% endif %}
        <a href="{{ url_for('routes.delete_task', id=task.id) }}" class="btn btn-outline-danger btn-sm">ğŸ—‘</a>
      </div>

    </div>
  </div>
  {% else %}
  <p class="text-muted text-center">No tasks added yet.</p>
  {% endfor %}

</div>

{% endblock %}
